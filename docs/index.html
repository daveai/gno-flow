<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GNO Flow Monitor</title>
<link rel="icon" type="image/png" href="favicon.png">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  html {
    overflow-y: scroll;
    -webkit-text-size-adjust: 100%;
  }

  body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
    background: #0a0a0a;
    color: #d4d4d4;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    padding: 32px 20px 48px;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  .container {
    width: 100%;
    max-width: 1080px;
  }

  /* ---- Header ---- */
  .header {
    display: flex;
    align-items: baseline;
    justify-content: space-between;
    border-bottom: 1px solid #1a1a1a;
    padding-bottom: 12px;
    margin-bottom: 0;
  }
  .header-left {
    display: flex;
    align-items: baseline;
    gap: 10px;
  }
  .title {
    font-size: 14px;
    font-weight: 700;
    color: #e8e8e8;
    text-transform: uppercase;
    letter-spacing: 1.4px;
  }
  .title-tag {
    font-family: 'JetBrains Mono', 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-size: 10px;
    color: #3e6957;
    letter-spacing: 0.5px;
    border: 1px solid #2a3f34;
    padding: 1px 6px;
    border-radius: 3px;
  }
  .meta {
    font-family: 'JetBrains Mono', 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-size: 10px;
    color: #555;
    text-align: right;
    line-height: 1.5;
  }
  .meta span { color: #777; }

  /* ---- Tabs ---- */
  .tabs {
    display: flex;
    gap: 0;
    border-bottom: 1px solid #1a1a1a;
  }
  .tab {
    padding: 10px 18px;
    cursor: pointer;
    color: #555;
    font-family: 'Inter', sans-serif;
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    transition: color 0.15s, border-color 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .tab:hover { color: #999; }
  .tab.active {
    color: #e0e0e0;
    border-bottom-color: #3e6957;
  }

  /* ---- Table wrapper ---- */
  .table-wrap {
    display: none;
    min-height: 200px;
  }
  .table-wrap.active { display: block; }

  .table-scroll {
    overflow-x: auto;
    -webkit-overflow-scrolling: touch;
  }

  table {
    width: 100%;
    min-width: 780px;
    border-collapse: collapse;
    font-size: 12px;
    table-layout: fixed;
  }
  thead { position: sticky; top: 0; z-index: 1; }
  th {
    text-align: left;
    padding: 8px 8px 6px;
    background: #0e0e0e;
    color: #555;
    font-size: 9px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.7px;
    border-bottom: 1px solid #1a1a1a;
    white-space: nowrap;
  }
  th.r { text-align: right; }

  td {
    padding: 5px 8px;
    border-bottom: 1px solid #131313;
    vertical-align: middle;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  tr:hover td { background: #111; }

  /* Column widths */
  col.c-rank   { width: 30px; }
  col.c-addr   { width: 96px; }
  col.c-label  { width: auto; }
  col.c-bal    { width: 86px; }
  col.c-in     { width: 86px; }
  col.c-out    { width: 86px; }
  col.c-net    { width: 96px; }
  col.c-count  { width: 54px; }
  col.c-chains { width: 76px; }

  /* Rank */
  .rank {
    font-family: 'JetBrains Mono', 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-size: 10px;
    color: #333;
    text-align: right;
    padding-right: 10px;
  }

  /* Address */
  .addr {
    font-family: 'JetBrains Mono', 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-size: 11px;
  }
  .addr a {
    color: #5a8fb0;
    text-decoration: none;
    transition: color 0.1s;
  }
  .addr a:hover {
    color: #7bb5d4;
    text-decoration: underline;
  }

  /* Label */
  .label { font-size: 11px; color: #888; }
  .label-text {
    background: #141414;
    border: 1px solid #1e1e1e;
    padding: 1px 5px;
    font-size: 10px;
    color: #999;
    border-radius: 2px;
    display: inline-block;
    max-width: 100%;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
  }
  .label-none { color: #1a1a1a; }

  /* Monospace right-aligned cells */
  .mono-r {
    font-family: 'JetBrains Mono', 'SF Mono', SFMono-Regular, Consolas, monospace;
    font-size: 11px;
    text-align: right;
  }

  /* Balance */
  .bal { color: #666; }

  /* Flow colors */
  .f-in { color: #1a9f5c; }
  .f-out { color: #b83a2e; }
  .f-net.pos { color: #1a9f5c; }
  .f-net.neg { color: #b83a2e; }

  /* Count */
  .count { color: #555; }

  /* Chains */
  .chains {
    font-size: 10px;
    color: #444;
    text-transform: lowercase;
  }
  .chain-dot {
    display: inline-block;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    margin-right: 3px;
    vertical-align: middle;
    position: relative;
    top: -1px;
  }
  .chain-dot.ethereum { background: #627eea; }
  .chain-dot.gnosis { background: #3e6957; }

  /* Show more button */
  .show-more-wrap {
    text-align: center;
    padding: 12px 0 4px;
  }
  .show-more-btn {
    background: none;
    border: 1px solid #1e1e1e;
    color: #666;
    font-family: 'Inter', sans-serif;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.6px;
    padding: 6px 20px;
    cursor: pointer;
    border-radius: 3px;
    transition: color 0.15s, border-color 0.15s, background 0.15s;
    -webkit-tap-highlight-color: transparent;
  }
  .show-more-btn:hover {
    color: #999;
    border-color: #333;
    background: #111;
  }

  /* States */
  .state-msg {
    padding: 30px 10px;
    text-align: center;
    font-size: 11px;
    color: #444;
  }
  .state-msg.err { color: #b83a2e; }

  /* ---- Responsive ---- */
  @media (max-width: 768px) {
    body { padding: 16px 12px 32px; }

    .header {
      flex-direction: column;
      gap: 6px;
    }
    .meta { text-align: left; }

    .tab { padding: 10px 14px; }

    col.c-label { width: 120px; }
  }

  @media (max-width: 480px) {
    body { padding: 12px 8px 24px; }

    .title { font-size: 12px; letter-spacing: 1px; }
    .title-tag { font-size: 9px; }
    .meta { font-size: 9px; }

    .tab {
      padding: 10px 10px;
      font-size: 10px;
    }

    td { padding: 4px 6px; }
    th { padding: 6px 6px; }
  }
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <div class="header-left">
      <span class="title">GNO Flow Monitor</span>
      <span class="title-tag">ETH / GNO</span>
    </div>
    <div class="meta" id="meta">--</div>
  </div>

  <div class="tabs">
    <button class="tab active" data-target="t7">7-Day Flows</button>
    <button class="tab" data-target="t30">30-Day Flows</button>
  </div>

  <div class="table-wrap active" id="t7">
    <div class="state-msg" id="s7">Loading&#8230;</div>
  </div>
  <div class="table-wrap" id="t30">
    <div class="state-msg" id="s30">Loading&#8230;</div>
  </div>
</div>

<script>
(function () {
  var INITIAL_ROWS = 35;
  var EXPLORERS = {
    ethereum: 'https://eth.blockscout.com/address/',
    gnosis: 'https://gnosis.blockscout.com/address/'
  };

  function truncAddr(a) {
    return a && a.length >= 12 ? a.slice(0, 6) + '\u2026' + a.slice(-4) : a;
  }

  function explorerUrl(addr, chains) {
    var chain = chains && chains.length === 1 ? chains[0] : 'ethereum';
    return (EXPLORERS[chain] || EXPLORERS.ethereum) + addr;
  }

  function fmtGno(val, forceSign) {
    var n = parseFloat(val);
    if (isNaN(n)) return val;
    var abs = Math.abs(n);
    var formatted;
    if (abs >= 1e6) formatted = (abs / 1e6).toFixed(1) + 'M';
    else if (abs >= 1e3) formatted = (abs / 1e3).toFixed(1) + 'K';
    else if (abs >= 1) formatted = abs.toFixed(1);
    else if (abs > 0) formatted = abs.toFixed(2);
    else return '--';
    if (forceSign) {
      return (n >= 0 ? '+' : '\u2212') + formatted;
    }
    return (n < 0 ? '\u2212' : '') + formatted;
  }

  function fmtNum(n) {
    return Number(n).toLocaleString();
  }

  function esc(s) {
    var el = document.createElement('span');
    el.textContent = s;
    return el.innerHTML;
  }

  function chainDots(chains) {
    var out = '';
    for (var i = 0; i < chains.length; i++) {
      out += '<span class="chain-dot ' + esc(chains[i]) + '"></span>' + esc(chains[i]);
      if (i < chains.length - 1) out += ', ';
    }
    return out;
  }

  function buildTable(rows, containerId, labels) {
    var container = document.getElementById(containerId);
    if (!rows || rows.length === 0) {
      container.innerHTML = '<div class="state-msg">No data.</div>';
      return;
    }
    var h = '<div class="table-scroll"><table>' +
      '<colgroup>' +
      '<col class="c-rank"><col class="c-addr"><col class="c-label">' +
      '<col class="c-bal"><col class="c-in"><col class="c-out"><col class="c-net">' +
      '<col class="c-count"><col class="c-chains">' +
      '</colgroup>' +
      '<thead><tr>' +
      '<th class="r">#</th>' +
      '<th>Address</th>' +
      '<th>Label</th>' +
      '<th class="r">Balance</th>' +
      '<th class="r">In</th>' +
      '<th class="r">Out</th>' +
      '<th class="r">Net</th>' +
      '<th class="r">Txfrs</th>' +
      '<th>Chain</th>' +
      '</tr></thead><tbody>';

    for (var i = 0; i < rows.length; i++) {
      var r = rows[i];
      var addr = r.address || '';
      var addrLower = addr.toLowerCase();
      var label = (labels && labels[addrLower]) ? labels[addrLower] : '';
      var labelHtml = label
        ? '<span class="label-text">' + esc(label) + '</span>'
        : '<span class="label-none">--</span>';

      var bal = r.balance ? fmtGno(r.balance) : '--';
      var inVal = r.inflow ? fmtGno(r.inflow) : '--';
      var outVal = r.outflow ? fmtGno(r.outflow) : '--';
      var netVal = fmtGno(r.net_flow, true);
      var netCls = parseFloat(r.net_flow) >= 0 ? 'pos' : 'neg';
      var hidden = i >= INITIAL_ROWS ? ' style="display:none" data-extra="1"' : '';

      h += '<tr' + hidden + '>' +
        '<td class="rank">' + (i + 1) + '</td>' +
        '<td class="addr"><a href="' + explorerUrl(addr, r.chains) + '" target="_blank" rel="noopener">' + truncAddr(addr) + '</a></td>' +
        '<td class="label">' + labelHtml + '</td>' +
        '<td class="mono-r bal">' + esc(bal) + '</td>' +
        '<td class="mono-r f-in">' + (inVal !== '--' ? '+' + esc(inVal) : '--') + '</td>' +
        '<td class="mono-r f-out">' + (outVal !== '--' ? '\u2212' + esc(outVal) : '--') + '</td>' +
        '<td class="mono-r f-net ' + netCls + '">' + esc(netVal) + '</td>' +
        '<td class="mono-r count">' + fmtNum(r.transfer_count) + '</td>' +
        '<td class="chains">' + chainDots(r.chains || []) + '</td>' +
        '</tr>';
    }

    h += '</tbody></table></div>';

    if (rows.length > INITIAL_ROWS) {
      h += '<div class="show-more-wrap"><button class="show-more-btn" data-container="' + containerId + '">' +
        'Show all ' + rows.length + ' addresses</button></div>';
    }

    container.innerHTML = h;

    var btn = container.querySelector('.show-more-btn');
    if (btn) {
      btn.addEventListener('click', function () {
        var extras = container.querySelectorAll('tr[data-extra]');
        for (var j = 0; j < extras.length; j++) {
          extras[j].style.display = '';
          extras[j].removeAttribute('data-extra');
        }
        this.parentNode.remove();
      });
    }
  }

  // Tab switching
  var tabs = document.querySelectorAll('.tab');
  for (var i = 0; i < tabs.length; i++) {
    tabs[i].addEventListener('click', function () {
      for (var j = 0; j < tabs.length; j++) tabs[j].classList.remove('active');
      var wraps = document.querySelectorAll('.table-wrap');
      for (var j = 0; j < wraps.length; j++) wraps[j].classList.remove('active');
      this.classList.add('active');
      document.getElementById(this.dataset.target).classList.add('active');
    });
  }

  // Fetch data
  fetch('summary.json')
    .then(function (r) {
      if (!r.ok) throw new Error('HTTP ' + r.status);
      return r.json();
    })
    .then(function (data) {
      var synced = data.synced_at
        ? new Date(data.synced_at).toISOString().replace('T', ' ').slice(0, 19) + ' UTC'
        : '--';
      var total = data.total_transfers ? fmtNum(data.total_transfers) : '0';
      document.getElementById('meta').innerHTML =
        '<span>' + total + '</span> transfers &middot; synced ' + synced;

      var labels = data.labels || {};
      buildTable(data.top_7d, 't7', labels);
      buildTable(data.top_30d, 't30', labels);
    })
    .catch(function (err) {
      document.getElementById('meta').textContent = 'Data unavailable';
      document.getElementById('s7').className = 'state-msg err';
      document.getElementById('s7').textContent = 'Error: ' + err.message;
      document.getElementById('s30').className = 'state-msg err';
      document.getElementById('s30').textContent = 'Error: ' + err.message;
    });
})();
</script>
</body>
</html>
